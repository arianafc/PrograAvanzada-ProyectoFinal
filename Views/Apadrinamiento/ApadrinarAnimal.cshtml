@model ProyectoFinal.EF.ObtenerAnimalPorIdSP_Result

@{
    ViewBag.Title = "ApadrinarAnimal";
    Layout = "~/Views/Shared/_Layout.cshtml";

    if (Session["IdUsuario"] == null)
    {
        Response.Redirect("~/Home/IniciarSesion");
    }
}

<main class="container py-5">
    <h1 class="fw-bold text-center mb-4">Proceso de apadrinamiento</h1>

    <p class="text-center mb-5">
        A través de este formulario, puedes contribuir al bienestar de los animales que más lo necesitan.
        Selecciona la cantidad y método de pago. ¡Gracias por ser parte del cambio!
    </p>


    @if (TempData["MensajeApadrinamiento"] != null)
    {
        <div class="alert alert-success text-center fw-bold">
            @TempData["MensajeApadrinamiento"]
        </div>
    }

    @if (TempData["ErrorApadrinamiento"] != null)
    {
        <div class="alert alert-danger text-center">
            @TempData["ErrorApadrinamiento"]
        </div>
    }

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger text-center">
            @ViewBag.Error
        </div>
    }

    <div class="row justify-content-center align-items-center g-4">
        <div class="col-lg-10">
            <div class="card border-0 overflow-hidden">
                <div class="row g-0">
                    <div class="col-md-5 d-none d-md-block bg-white">
                        <div class="h-100 d-flex align-items-center justify-content-center p-3">
                            <img src="~/imagenes/animalesDonar.png" alt="Animales felices" class="img-fluid" style="max-height: 400px;">
                        </div>
                    </div>

                    <div class="col-md-7">
                        <div class="card-body bg-light h-100 d-flex flex-column justify-content-center">
                            <h4 class="fw-bold text-center text-dark mb-4">Formulario de Apadrinamiento</h4>

                            <!-- Formulario para enviar datos al servidor -->
                            @using (Html.BeginForm("ApadrinarAnimal", "Apadrinamiento", FormMethod.Post, new { id = "formApadrinarAnimal" }))
                            {
                                @Html.Hidden("idAnimal", Model.ID_ANIMAL)
                                @Html.Hidden("metodo", null, new { id = "inputMetodoPago" })
                                @Html.Hidden("montoMensual", null, new { id = "inputMontoMensual" })
                                @Html.Hidden("referencia", null, new { id = "inputReferencia" })
                            }

                            <!-- Formulario visual para el usuario -->
                            <div id="formApadrinar">
                                <div class="mb-3">
                                    <label for="montoMensual" class="form-label fw-bold">Monto mensual (mínimo $50)</label>
                                    <input type="number" id="montoMensual" name="montoMensual" class="form-control"
                                           placeholder="Digite la cantidad" min="50" step="0.01" required />
                                </div>

                                <div class="mb-3">
                                    <label for="metodo" class="form-label fw-bold">Método de pago</label>
                                    <select id="metodo" name="metodo" class="form-select" required>
                                        <option value="">Selecciona un método de pago</option>
                                        <option value="tarjeta">Tarjeta crédito/débito</option>
                                        <option value="sinpe">Sinpe móvil</option>
                                        <option value="paypal">PayPal</option>
                                    </select>
                                </div>

                                <div class="d-grid">
                                    <button type="button" class="btn btn-warning fw-bold text-dark" id="btnApadrinar" onclick="mostrarModalApadrinamiento()">Apadrinar</button>
                                </div>
                                <div class="d-grid mt-2">
                                    @Html.ActionLink("Volver", "ConsultarAnimales", "Animal", null, new { @class = "volver-btn" })
                                </div>
                            </div>

                            <p class="text-center text-muted mt-3 small">
                                <i class="fas fa-heart text-warning"></i> Gracias por tu generosidad
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modal Tarjeta -->
<div class="modal fade" id="modalTarjeta" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pago con Tarjeta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="numeroTarjeta">Número de tarjeta</label>
                    <input type="text" id="numeroTarjeta" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX" required />
                </div>
                <div class="mb-3">
                    <label for="titularTarjeta">Nombre del titular</label>
                    <input type="text" id="titularTarjeta" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="codigoSeguridad">Código de seguridad</label>
                    <input type="text" id="codigoSeguridad" class="form-control" placeholder="XXX" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="enviarFormularioApadrinamiento(1)">Finalizar Apadrinamiento</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Sinpe -->
<div class="modal fade" id="modalSinpe" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pago por Sinpe Móvil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Realice su Sinpe al número: <strong>70265643</strong></p>
                <p>Nombre del titular: <strong>Casa Natura</strong></p>
                <div class="mb-3">
                    <label for="referenciaApadrinamiento" class="form-label fw-bold">Número de referencia Sinpe</label>
                    <input type="text" id="referenciaApadrinamiento" name="referencia" class="form-control"
                           placeholder="Digite el número de referencia"
                           pattern="^\d{6,30}$"
                           title="Solo números, mínimo 6 dígitos" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="enviarFormularioApadrinamiento(2)">Finalizar Apadrinamiento</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal PayPal -->
<div class="modal fade" id="modalPaypal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pago con PayPal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="usuarioPaypal">Usuario de PayPal</label>
                    <input type="text" id="usuarioPaypal" class="form-control" placeholder="Correo o usuario" required />
                </div>
                <div class="mb-3">
                    <label for="contrasenaPaypal">Contraseña</label>
                    <input type="password" id="contrasenaPaypal" class="form-control" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="enviarFormularioApadrinamiento(3)">Finalizar Apadrinamiento</button>
            </div>
        </div>
    </div>
</div>

<script src="@Url.Content("~/Scripts/CasaNatura.js")"></script>
<script src="@Url.Content("~/Scripts/Apadrinamientos.js")"></script>